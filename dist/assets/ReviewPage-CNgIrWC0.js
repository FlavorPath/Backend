import{u as p,q as g,r as b,j as a,c as r,d as y,g as j,h}from"./index-8zlRE-qI.js";import{u as N}from"./restaurant.query-DLrNq_Bs.js";import{a as m}from"./index-DTlkZk8a.js";import{u as R}from"./useQuery-DXe8zmVD.js";import{u as f}from"./index-Cc4pVggC.js";import{c as S}from"./react-BldeI6aZ.js";import{B as v}from"./Button-B76DXv8C.js";import{H as F}from"./Header-RVW2r6Qh.js";import{a as C,f as k}from"./float-GDraHBfA.js";import"./api-path-DnyBEyJv.js";import"./auth.store-C-PIHe4R.js";import"./Icon-DN8LPNFT.js";import"./index-DqL8lkA2.js";const q=async e=>(await m.get(`/user/review/${e}`)).data,T=async(e,t)=>(await m.put(`/user/review/${e}`,{content:t})).data,_=async(e,t)=>(await m.post(`/restaurant/${e}/reviews`,{content:t})).data,$=({restaurantId:e})=>{const t=p();return f({mutationFn:({content:s,restaurantId:n})=>_(n,s),onSuccess:()=>{g.invalidateQueries({queryKey:["get-reviews"]}),t(`/restaurant/${e}/review`)}})},H=({restaurantId:e})=>{const t=p();return f({mutationFn:({reviewId:s,content:n})=>T(s,n),onSuccess:()=>{g.invalidateQueries({queryKey:["get-reviews"]}),t(`/restaurant/${e}/review`)}})},I=({reviewId:e})=>R({queryKey:["review"],queryFn:()=>q(e),enabled:!!e}),w=S(e=>({content:"",setContent:t=>e({content:t}),isFocused:!1,setIsFocused:t=>e({isFocused:t})})),A=({targetId:e,reviewId:t})=>{const{content:s,isFocused:n,setContent:i}=w(),{data:o}=N(e),{data:l}=I({reviewId:t}),{mutate:u}=H({restaurantId:e}),{mutate:d}=$({restaurantId:e});return b.useEffect(()=>{var x;l&&i((x=l[0])==null?void 0:x.content)},[l]),{isUpdate:!!t,restaurant:o,isFocused:n,content:s,onSave:()=>{t?u({reviewId:t,content:s}):d({restaurantId:e,content:s}),i("")}}},B=()=>{const{content:e,setContent:t,setIsFocused:s}=w();return a.jsx("textarea",{className:M.textarea,value:e,onChange:n=>t(n.target.value),maxLength:200,placeholder:"리뷰를 남겨주세요!",onFocus:()=>s(!0),onBlur:()=>s(!1)})},M={textarea:r({borderColor:"primary.main",borderWidth:"1px",borderRadius:"16px",height:"255px",resize:"none",marginTop:"24px",width:"100%",outline:"none",padding:"15px",textStyle:"body3",fontWeight:"light",lineHeight:"20px"})},P=()=>/iPhone|Android|Mobile/i.test(navigator.userAgent),Z=()=>{const e=p(),{reviewId:t}=y(),[s]=j(),n=P(),{isUpdate:i,restaurant:o,isFocused:l,content:u,onSave:d}=A({targetId:Number(s.get("targetId")),reviewId:Number(t)||0});return a.jsxs("div",{className:c.container,children:[a.jsx(F,{headerText:i?"리뷰 수정하기":"리뷰 남기기"}),a.jsxs("div",{className:r({margin:"0 30px"}),children:[a.jsx("h3",{className:c.title,children:o==null?void 0:o.name}),a.jsx("p",{className:c.address,children:o==null?void 0:o.address}),a.jsxs("div",{className:r({position:"relative"}),children:[a.jsx(B,{}),a.jsxs("span",{className:c.length,children:[u==null?void 0:u.length," / 200"]})]})]}),a.jsxs("div",{className:h(c.button_grp,r({margin:l&&n?"18px auto 0":"0 30px 0",position:l&&n?"sticky":"absolute"})),children:[i&&a.jsx(v,{variant:"outlined",className:c.cancel_btn,onClick:()=>e(-1),children:"취소"}),a.jsx(v,{size:"large",className:h(c.save_button,r({marginLeft:i?"8px":0})),onClick:d,children:i?"리뷰 수정하기":"리뷰 등록하기"})]})]})},c={container:r({height:"100dvh",position:"relative",display:"flex",flexDir:"column"}),title:r({textStyle:"heading2",display:"-webkit-box",WebkitLineClamp:2,overflow:"hidden",textOverflow:"ellipsis",wordBreak:"keep-all",whiteSpace:"pre-wrap",lineHeight:"30px",marginTop:"20px"}),address:r({marginTop:"6px",textStyle:"body3",lineHeight:"20px"}),button_grp:k({width:"calc(100% - 60px)",bottom:"25px",left:0,zIndex:10}),cancel_btn:r({width:"123px"}),save_button:r({flex:1}),length:C({placement:"bottom-end",right:"50px",bottom:"25px",textStyle:"body3"})};export{Z as default};
