import{r as f,j as t,c as n,f as C,u as P}from"./index-8zlRE-qI.js";import{u as R,a as L}from"./restaurantReview.query-DWsTRlx6.js";import{a as b}from"./index-DTlkZk8a.js";import{u as S}from"./useQuery-DXe8zmVD.js";import{u as I}from"./index-Cc4pVggC.js";import{A as w}from"./api-path-DnyBEyJv.js";import{u as j}from"./auth.store-C-PIHe4R.js";import{I as N}from"./Icon-DN8LPNFT.js";import{c as y,f as U}from"./float-GDraHBfA.js";import{H as E}from"./Header-RVW2r6Qh.js";import"./react-BldeI6aZ.js";import"./index-DqL8lkA2.js";const D=async({cursor:e=0})=>{const r=`/user/review?cursor=${e}`;return(await b.get(r,{headers:{Authorization:`Bearer ${localStorage.getItem("auth-token")}`}})).data},W=()=>R({queryKey:["userReviews"],queryFn:({pageParam:e=0})=>D({cursor:e}),getNextPageParam:e=>{if(!(e.success||e.lastCursor===null))return e.lastCursor},initialPageParam:0}),$=()=>{const{data:e,fetchNextPage:r,hasNextPage:a,isFetchingNextPage:o,isFetching:s,refetch:c}=W(),{mutate:l}=L(),i=f.useRef(null);return f.useEffect(()=>{if(!a||o)return;const d=new IntersectionObserver(h=>{h[0].isIntersecting&&r()},{threshold:1});return i.current&&d.observe(i.current),()=>{i.current&&d.unobserve(i.current)}},[r,a,o]),{reviews:e?e.pages.flatMap(d=>d.reviews):[],isFetching:s,isFetchingNextPage:o,hasNextPage:a,observerTarget:i,handleDeleteReview:d=>{window.confirm("정말로 이 리뷰를 삭제하시겠습니까?")&&l(d,{onSuccess:()=>{console.log(`리뷰 ${d} 삭제 성공`),c()},onError:h=>{console.error(`리뷰 ${d} 삭제 실패:`,h)}})},refetch:c}},T=async()=>{const{accessToken:e}=j.getState();if(!e)throw new Error("토큰 없음");const r=`${w.userInfo}`;return(await b.get(r,{headers:{Authorization:`Bearer ${e}`}})).data},A=async e=>{const{accessToken:r}=j.getState();if(!r)throw new Error("토큰 없음");const a=`${w.userNickname}`,o=await b.put(a,e,{headers:{Authorization:`Bearer ${r}`}});return console.log("닉네임 변경 요청 완료"),o.data},F=async e=>{const{accessToken:r}=j.getState();if(!r)throw new Error("토큰 없음");const a=`${w.userProfileIcon}`,o=new FormData;o.append("profileIcon",e);const s=await b.put(a,o,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}});return console.log("프로필 아이콘 수정 요청 완료"),s.data},B=()=>S({queryKey:["userInfo"],queryFn:T,staleTime:5e3}),z=()=>I({mutationFn:e=>A(e),onSuccess:e=>{e.success?console.log("닉네임 변경 성공"):console.error("닉네임 변경 실패:",e.message)},onError:e=>{console.error("닉네임 변경 요청 중 오류 발생:",e)}}),H=()=>I({mutationFn:F,onSuccess:()=>{console.log("프로필 아이콘 수정 성공:")},onError:e=>{console.error("프로필 아이콘 수정 실패:",e)}}),k=()=>{const{data:e,isLoading:r,error:a,refetch:o}=B(),{mutate:s,isPending:c,error:l}=z(),{mutate:i,isPending:p,error:m}=H();return{userInfo:e,isUserLoading:r,userError:a,refetchUserInfo:o,updateNickname:s,isNicknameUpdating:c,nicknameError:l,updateProfileIcon:i,isProfileIconUpdating:p,profileIconError:m}},q=()=>{const{userInfo:e,updateProfileIcon:r,isProfileIconUpdating:a}=k(),[o,s]=f.useState(e==null?void 0:e.data.icon),c=l=>{var p;const i=(p=l.target.files)==null?void 0:p[0];if(i){const m=new FileReader;m.onloadend=()=>{s(m.result)},m.readAsDataURL(i),r(i)}};return t.jsxs("div",{className:x.container,children:[t.jsx("label",{htmlFor:"profile-image",className:x.label,children:t.jsx("div",{className:x.imageContainer,children:o?t.jsx("img",{src:o,alt:"미리보기",className:x.image}):t.jsx("div",{className:x.placeholder})})}),t.jsx("input",{type:"file",id:"profile-image",accept:"image/*",onChange:c,className:x.input,disabled:a}),a&&t.jsx("p",{children:"업로드 중..."})]})},x={container:n({textAlign:"center"}),label:n({display:"inline-block",cursor:"pointer"}),imageContainer:n({width:"120px",height:"120px",borderRadius:"50%",overflow:"hidden",backgroundColor:"#f0f0f0",border:"2px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center"}),image:n({width:"100%",height:"100%",objectFit:"cover"}),placeholder:n({width:"100%",height:"100%",backgroundColor:"#e0e0e0"}),input:n({display:"none"})},K=()=>{const{userInfo:e,isUserLoading:r,userError:a,updateNickname:o,isNicknameUpdating:s,refetchUserInfo:c}=k(),[l,i]=f.useState(!1),[p,m]=f.useState((e==null?void 0:e.data.nickname)||""),d=()=>{if(!p.trim()){alert("닉네임은 비어 있을 수 없습니다.");return}o({nickname:p},{onSuccess:()=>{alert("닉네임이 성공적으로 변경되었습니다."),i(!1),c()},onError:h=>{console.error("닉네임 변경 실패:",h),alert("닉네임 변경 중 오류가 발생했습니다.")}})};return r?t.jsx("div",{className:y({height:"100%"}),children:"로딩 중..."}):a?t.jsx("div",{className:y({height:"100%"}),children:"사용자 정보를 가져오는 중 오류가 발생했습니다."}):t.jsxs("div",{className:g.container,children:[t.jsx(q,{}),t.jsx("div",{className:g.nicknameContainer,children:l?t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"text",value:p,onChange:h=>m(h.target.value),className:g.nicknameInput,maxLength:20}),t.jsx("button",{onClick:d,className:g.saveButton,children:"저장"}),t.jsx("button",{onClick:()=>i(!1),className:g.cancelButton,children:"취소"})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:g.nickname,children:(e==null?void 0:e.data.nickname)||"닉네임 없음"}),t.jsx("span",{className:g.tag,children:(e==null?void 0:e.data.tag)||"태그 없음"}),t.jsx(N,{iconName:"PencilIcon",library:"hero-solid",fill:"#000000",className:g.editIcon,onClick:()=>i(!0)})]})}),s&&t.jsx("div",{className:U({paddingTop:"30px",position:"absolute",left:"50%",transform:"translateX(-50%)"}),children:t.jsx(C,{})})]})},g={container:n({textAlign:"center",borderRadius:"5px",padding:"10px"}),nicknameContainer:n({display:"flex",alignItems:"center",justifyContent:"center",gap:"2px",marginTop:"10px"}),nickname:n({fontSize:"18px",fontWeight:"bold"}),tag:n({fontSize:"18px",color:"background.gray",fontWeight:"medium"}),editIcon:n({cursor:"pointer",marginLeft:"5px",width:"18px",height:"18px"}),nicknameInput:n({fontSize:"16px",padding:"5px",border:"1px solid #ddd",borderRadius:"5px"}),saveButton:n({marginLeft:"5px",padding:"5px 10px",backgroundColor:"primary.main",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer"}),cancelButton:n({marginLeft:"5px",padding:"5px 10px",backgroundColor:"white",color:"black",border:"1px solid #ff8700",borderRadius:"5px",cursor:"pointer"})},M="/assets/KoreanLabel-DPvs1TAB.svg",Q="/assets/DessertLabel-DKHNPZRv.svg",_="/assets/ChineseLabel-CtX434eE.svg",J="/assets/WesternLabel-CxgFfbQL.svg",X="/assets/JapaneseLabel-BHran5j_.svg",G={한식:M,디저트:Q,중식:_,양식:J,일식:X},O=({content:e,reviewId:r,onEdit:a,onDelete:o,label:s,name:c})=>{const l=G[s];return t.jsxs("div",{className:u.reviewItem,children:[t.jsxs("div",{className:u.reviewHeader,children:[t.jsx("div",{className:u.labelWrapper,children:l&&t.jsx("img",{src:l,alt:s,className:u.labelIcon})}),t.jsx("p",{className:u.restaurantName,children:c}),t.jsxs("div",{className:u.iconWrapper,children:[t.jsx(N,{iconName:"PencilSquareIcon",library:"hero-solid",fill:"#d9d9d9",onClick:()=>a(r),className:u.icon}),t.jsx(N,{iconName:"TrashIcon",library:"hero-solid",fill:"#d9d9d9",onClick:()=>o(r),className:u.icon})]})]}),t.jsx("div",{className:u.reviewContent,children:e})]})},u={reviewItem:n({padding:"10px",display:"flex",flexDirection:"column",gap:"10px",position:"relative"}),reviewHeader:n({display:"flex",justifyContent:"space-between",alignItems:"center"}),labelWrapper:n({display:"flex",alignItems:"center",gap:"8px"}),labelIcon:n({width:"24px",height:"24px"}),labelText:n({textStyle:"body2",fontWeight:"bold"}),restaurantName:n({textStyle:"body2",fontWeight:"bold"}),iconWrapper:n({display:"flex",gap:"10px"}),icon:n({cursor:"pointer",width:"20px",height:"20px"}),reviewContent:n({textStyle:"body3",color:"#333"}),reviewDate:n({textStyle:"body4",color:"#777"})},le=()=>{const{reviews:e,handleDeleteReview:r}=$(),a=P(),o=s=>{console.log(`Edit review ID: ${s}`),a(`/review/${s}?type=edit`)};return t.jsxs("div",{className:v.container,children:[t.jsxs("div",{className:v.userWrapper,children:[t.jsx(E,{headerText:"내 정보"}),t.jsx(K,{})]}),t.jsx("div",{className:v.reviewWrapper,children:e!=null&&e.length?e.map(s=>t.jsx(O,{label:s.label,content:s.content,reviewId:s.id,name:s.restaurant_name,onEdit:o,onDelete:r},s.id)):t.jsx("div",{className:v.noResult,children:"리뷰를 작성해주세요."})})]})},v={container:n({width:"100%",height:"100dvh",display:"flex",flexDirection:"column",position:"relative"}),userWrapper:n({display:"flex",flexDirection:"column",width:"100%",height:"250px"}),line:n({position:"absolute",top:"280px",left:0,height:"5px",width:"100%",backgroundColor:"background.gray"}),reviewWrapper:n({width:"100%",display:"flex",flexDirection:"column",gap:"20px",padding:"10px 20px",overflowY:"auto"}),observerTarget:n({height:"50px",display:"flex",alignItems:"center",justifyContent:"center"}),noResult:y({height:"calc(100dvh - 400px)",textAlign:"center",textStyle:"caption1",fontWeight:"light"})};export{le as default};
